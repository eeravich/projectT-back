<?xml version="1.0" encoding="UTF-8" ?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd"
>
    <changeSet id="projectT-initialization-01" author="bullov" logicalFilePath="inc1.xml">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="account" schemaName="project_T"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "project_T".account(
                id BIGSERIAL NOT NULL PRIMARY KEY,
                entity_id BIGINT NOT NULL,
                created_datetime TIMESTAMP NOT NULL default now(),
                deleted_datetime TIMESTAMP,
                login TEXT NOT NULL,
                password TEXT NOT NULL,
                email TEXT NOT NULL,
                name TEXT NOT NULL,
                surname TEXT NOT NULL,
                phone TEXT NOT NULL,
                role_id INTEGER NOT NULL,
                is_blocked BOOLEAN NOT NULL DEFAULT FALSE
            );
        </sql>
    </changeSet>

    <changeSet id="projectT-initialization-02" author="bullov" logicalFilePath="inc1.xml">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="address" schemaName="project_T"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "project_T".address(
                id BIGSERIAL NOT NULL PRIMARY KEY,
                entity_id BIGINT NOT NULL,
                created_datetime TIMESTAMP NOT NULL default now(),
                deleted_datetime TIMESTAMP,
                street TEXT,
                house TEXT,
                apartment TEXT,
                entrance INTEGER,
                floor INTEGER,
                code TEXT,
                account_entity_id BIGINT
            );
        </sql>
    </changeSet>

    <changeSet id="projectT-initialization-03" author="bullov" logicalFilePath="inc1.xml">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="combo" schemaName="project_T"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "project_T".combo(
                id BIGSERIAL NOT NULL PRIMARY KEY,
                entity_id BIGINT NOT NULL,
                created_datetime TIMESTAMP NOT NULL default now(),
                deleted_datetime TIMESTAMP,
                name TEXT,
                description TEXT,
                price NUMERIC(12, 2),
                attachment_id BIGINT
            );
        </sql>
    </changeSet>

    <changeSet id="projectT-initialization-04" author="bullov" logicalFilePath="inc1.xml">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="component" schemaName="project_T"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "project_T".component(
                id BIGSERIAL NOT NULL PRIMARY KEY,
                entity_id BIGINT NOT NULL,
                created_datetime TIMESTAMP NOT NULL default now(),
                deleted_datetime TIMESTAMP,
                name TEXT,
                description TEXT
            );
        </sql>
    </changeSet>

    <changeSet id="projectT-initialization-05" author="bullov" logicalFilePath="inc1.xml">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="discount" schemaName="project_T"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "project_T".discount(
                id BIGSERIAL NOT NULL PRIMARY KEY,
                entity_id BIGINT NOT NULL,
                created_datetime TIMESTAMP NOT NULL default now(),
                deleted_datetime TIMESTAMP,
                name TEXT,
                description TEXT,
                percent INTEGER,
                promocode TEXT,
                is_active BOOLEAN NOT NULL DEFAULT FALSE,
                start_datetime TIMESTAMP,
                end_datetime TIMESTAMP
            );
        </sql>
    </changeSet>

    <changeSet id="projectT-initialization-06" author="bullov" logicalFilePath="inc1.xml">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="feedback" schemaName="project_T"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "project_T".feedback(
                id BIGSERIAL NOT NULL PRIMARY KEY,
                entity_id BIGINT NOT NULL,
                created_datetime TIMESTAMP NOT NULL default now(),
                deleted_datetime TIMESTAMP,
                comment TEXT,
                account_entity_id BIGINT NOT NULL
            );
        </sql>
    </changeSet>

    <changeSet id="projectT-initialization-07" author="bullov" logicalFilePath="inc1.xml">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="order" schemaName="project_T"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "project_T"."order"(
                id BIGSERIAL NOT NULL PRIMARY KEY,
                entity_id BIGINT NOT NULL,
                created_datetime TIMESTAMP NOT NULL default now(),
                deleted_datetime TIMESTAMP,
                account_entity_id BIGINT,
                phone TEXT,
                name TEXT,
                is_cash BOOLEAN NOT NULL DEFAULT FALSE,
                change INTEGER,
                comment TEXT,
                addons_count INTEGER,
                discount_id BIGINT,
                delivery_time TIMESTAMP,
                email TEXT,
                status_id INTEGER,
                address_entity_id BIGINT
            );
        </sql>
    </changeSet>

    <changeSet id="projectT-initialization-08" author="bullov" logicalFilePath="inc1.xml">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="order_status" schemaName="project_T"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "project_T".order_status(
                id SERIAL NOT NULL PRIMARY KEY,
                name TEXT
            );
        </sql>
    </changeSet>

    <changeSet id="projectT-initialization-09" author="bullov" logicalFilePath="inc1.xml">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="product" schemaName="project_T"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "project_T".product(
                id BIGSERIAL NOT NULL PRIMARY KEY,
                entity_id BIGINT NOT NULL,
                created_datetime TIMESTAMP NOT NULL default now(),
                deleted_datetime TIMESTAMP,
                name TEXT,
                description TEXT,
                price NUMERIC(12, 2),
                portion INTEGER,
                weight INTEGER,
                product_type_id INTEGER,
                attachment_id BIGINT
            );
        </sql>
    </changeSet>

    <changeSet id="projectT-initialization-10" author="bullov" logicalFilePath="inc1.xml">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="product_type" schemaName="project_T"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "project_T".product_type(
                id SERIAL NOT NULL PRIMARY KEY,
                name TEXT
            );
        </sql>
    </changeSet>

    <changeSet id="projectT-initialization-11" author="bullov" logicalFilePath="inc1.xml">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="ref_combo_discount" schemaName="project_T"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "project_T".ref_combo_discount(
                id BIGSERIAL NOT NULL PRIMARY KEY,
                combo_id BIGINT,
                discount_id BIGINT,
                is_actual BOOLEAN NOT NULL DEFAULT FALSE
            );
        </sql>
    </changeSet>

    <changeSet id="projectT-initialization-12" author="bullov" logicalFilePath="inc1.xml">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="ref_combo_product" schemaName="project_T"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "project_T".ref_combo_product(
                id BIGSERIAL NOT NULL PRIMARY KEY,
                combo_id BIGINT,
                product_id BIGINT,
                product_count INTEGER,
                is_actual BOOLEAN NOT NULL DEFAULT FALSE
            );
        </sql>
    </changeSet>

    <changeSet id="projectT-initialization-13" author="bullov" logicalFilePath="inc1.xml">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="ref_order_product" schemaName="project_T"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "project_T".ref_order_product(
                id BIGSERIAL NOT NULL PRIMARY KEY,
                order_id BIGINT,
                product_id BIGINT,
                count INTEGER,
                is_actual BOOLEAN NOT NULL DEFAULT FALSE
            );
        </sql>
    </changeSet>

    <changeSet id="projectT-initialization-14" author="bullov" logicalFilePath="inc1.xml">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="ref_order_combo" schemaName="project_T"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "project_T".ref_order_combo(
                id BIGSERIAL NOT NULL PRIMARY KEY,
                order_id BIGINT,
                combo_id BIGINT,
                count INTEGER,
                is_actual BOOLEAN NOT NULL DEFAULT FALSE
            );
        </sql>
    </changeSet>

    <changeSet id="projectT-initialization-15" author="bullov" logicalFilePath="inc1.xml">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="ref_product_component" schemaName="project_T"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "project_T".ref_product_component(
                id BIGSERIAL NOT NULL PRIMARY KEY,
                product_id BIGINT,
                component_id BIGINT,
                is_actual BOOLEAN NOT NULL DEFAULT FALSE
            );
        </sql>
    </changeSet>

    <changeSet id="projectT-initialization-16" author="bullov" logicalFilePath="inc1.xml">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="ref_product_discount" schemaName="project_T"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "project_T".ref_product_discount(
                id BIGSERIAL NOT NULL PRIMARY KEY,
                product_id BIGINT,
                discount_id BIGINT,
                is_actual BOOLEAN NOT NULL DEFAULT FALSE
            );
        </sql>
    </changeSet>

    <changeSet id="projectT-initialization-17" author="bullov" logicalFilePath="inc1.xml">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="role" schemaName="project_T"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "project_T".role(
                id SERIAL NOT NULL PRIMARY KEY,
                name TEXT,
                description TEXT
            );
        </sql>
    </changeSet>

</databaseChangeLog>